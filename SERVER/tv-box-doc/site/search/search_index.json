{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Overall design","text":"<p>For safety app does not receive and listen for any commands. It checks state of the server, downloads data and executes functions on it self. After switching it on its \"fire and forget\" missile system.</p> <p>Made to use with <code>.jpg</code> and <code>.mp4</code> files. Thats whats programmed for, you can add more formats -&gt; edit upload php and electron client app source code.</p> <p>TODO: Email notification system - as follows -&gt; In database the notification table have TINYINT/BOOL value that determines if notification was sent.The server runs CRON task executing script that creates and sends in email all notifications that have value of 0 in the <code>email_sent</code> column. Than after sending the email. Sent notifications <code>email_sent</code> values are set to 1. The system also have logic in generating notifications - for example checks if any device is offline more than 1hour and creates notification that is also sent to established email.</p> <p>//PHP MAILER if PHP script //in admin panel email notifications btn to configure mail server -&gt; save settings into file</p> <p>//GetConfig in the client app got redone from downloading JSON from server to generating json locally. Somehow on localhost everything worked fine, but after deploy to remote server the app downloaded configuration that was 1version behind the current configuration even when the file on the server got rewritten. The database was up to date, the file configs ware overwritten, but the client some how was getting file that should not be even there. Bet the www CACHE got something to do with it. Now it's based on DB and client side JSON creation.</p> <p>Inside <code>display.php</code> and <code>media.php</code> - video tags have by default inserted <code>preload=\"none\"</code>, to prevent huge downloads, lag spikes and load times if deployed in remote location that isn't local-hosted or super fast. The attribute can be removed in PHP sections dedicated to displaying media.</p> <p>WWW Interface shows status of the devices as colored dots. There are 4 states of the devices, with 3 default states <code>(GREEN,YELLOW,RED)</code> and 1 default <code>(BLUE)</code>. Blue state is set by default when device was added by hand into database or the timestamp of last dbPing is empty. If you see blue and you operate client devices correctly - something went wrong. Status can become <code>YELLOW</code> or even <code>RED</code> while internet is slow or client has a lot to download into local <code>/media</code> folder from (for example) slow server. Than in the meantime (downloading time) there are no dbPings, so the device may seem offline for that time. If you want to be sure - ssh into the device. If you can connect - it works and internet is up, you can check if TV BOX app is running or XRDP (if configured) to check screen.</p> <p>The original plan was to omit usage of database, but since it would greatly limit www interface - the plan changed. Since that change the JSON is now generated by devices not www interface, and instead of downloading file from the server, client sends query to DB. It now depends on reliable database, don;t worry the app will work even when client internet is gone or database is offline. It will display based of the current config and files, until detection of the internet and database.</p> <p>The design also allows configuring device to connect to local database and even local media folder, provided data integrity - database cloning from remote source and cloning of source media folder. That can be achieved even by simply syncing data from server to clients by for example mega.nz application, same for database -&gt;main database on the www interface cloned into <code>localhosts</code> of clients.</p> <p>Empty Indexes in www interface folders like <code>/media</code> are there to prevent listing files. However since those files are public anyway, you can safely delete that index file. Other empty indexes can be deleted too (except <code>/log</code> - even having <code>.htaccess</code> I would not delete that empty index). Their existence is purely for esthetic reasons.</p> <p>You can restrict direct access for <code>/media</code> and other folders by writing <code>.htaccess</code> file with <code>Deny All</code></p> <p>If you change channel of the device, te ensure the device will get new config save channel configuration. Device could have date that is newer or older than configuration date of your channel, so you have 50% chance it will download new config. To avoid that 50% loose -&gt; every time the device changes channel -&gt; save channel config.</p> <p>Do not delete files - videos and images UNTIL they are no longer in any config file in devices! Until then every device on startup will try to reach up to the server and download that file - than update it's configuration. In other words - until all devices are up to date and have config files updated, do not delete files used in previous configuration from the server. Otherwise you wil get CURL (18) ERROR.</p> <p>Admin user in WWW interface can add/delete Users and change all users passwords. Admin can also see logs of the WWW interface. The <code>admin.php</code> (Admin Panel) is shown and can be accessed only by admins.</p>"},{"location":"#example-cron-for-sending-emails-with-notifications","title":"EXAMPLE CRON //for sending emails with notifications","text":"<ul> <li><code>Here example cron</code> - checks for unsent notifications every 10 min.</li> <li><code>Here example cron</code> - checks for unsent notifications every day at 9:00 am.</li> </ul>"},{"location":"#project-layout-most-important-things","title":"Project layout (most important things)","text":"<p>SERVER SIDE</p> <pre><code>login.php\nmedia/  # Upload folder for all media/folder to point app to download from.\nlog/    # WWW Interface action/error logs\n</code></pre> <p>CLIENT SIDE</p> <pre><code>main.js         # Main program\nrenderer.js     # Renderer\nmedia/\n    example.mp4   # Downloaded from media folder on the server.\n    example.jpg   # Downloaded from media folder on the server.\n    ...\n</code></pre>"},{"location":"#tv-box-how-does-it-work","title":"TV BOX - How does it work?","text":"<p>At program start - initiates it self and tries to download files from present config.json file, using settings in db_config.json and remote_config.json.</p> <p>Program loop is executing every 10 minutes by default. Currently you have to edit the code to set up different timer. // TO DO - load timer from file in client and server.</p> <p>Communication is based on .json files generated and stored on the server.Clients do not listen to anything. They make queries to db to check, if timestamp of config on the server is same or greater of locally stored timestamp. If timestamp on the server is newer, the client downloads new configuration file and than after the check starts downloading files from media folder on the server.</p> <p>The client does not need reload or relaunch of the application. Clients listen to any changes to their local configuration file. If detected, they automatically apply changes.</p> <p>Files from new configuration file are download into temp folder, so if internet connection breaks or the file download fails, changes will not be 'saved' and the system will work on previous config without interruptions.</p> <p>The www panel login system is simple and it's recommended to secure it additionally to the systems that are present. HGashes are stored in DB as bcrypt (PHP standard) and there is simple anti BRUTE-FORCE system present. Securing login form with some CAPTCHA would be great. Securing your website or at least subdomain with the app using CloudFlare can bew helpful and it's recommended,</p> <p>CLient Device after powering up and proper configuration will show up automatically in the web interface. It looks for 'UPDATE' query, but when record is not present - uses 'INSERT' instead.</p> <p>When adding video into channel the www panel automatically checks the length of the video thanks to getID3 and sets the value for ease of use.</p>"},{"location":"#simple-system-schema","title":"Simple system schema","text":""},{"location":"#database","title":"Database","text":"<p>SQL server used to develop the app was MariaDB. If you are using different database, make sure to check all queries and DB Schema to avoid problems. Sql file should be easy to convert into other DB's like PostgreSQL, since structure and types are very basic. You could do it even by hand.</p>"},{"location":"#how-device-playlist-config-file-looks-like-after-program-makes-it","title":"How device 'playlist' config file looks like after program makes it","text":"<pre><code>[\n    {\n        \"type\": \"video\",\n        \"name\": \"1.mp4\",\n        \"timer\": 10\n    },\n    {\n        \"type\": \"image\",\n        \"name\": \"1.jpg\",\n        \"timer\": 3\n    },\n    {\n        \"type\": \"video\",\n        \"name\": \"2.mp4\",\n        \"timer\": 10\n    },\n    {\n        \"type\": \"video\",\n        \"name\": \"3.mp4\",\n        \"timer\": 10\n    },\n    {\n        \"type\": \"image\",\n        \"name\": \"2.jpg\",\n        \"timer\": 3\n    },\n    {\n        \"type\": \"image\",\n        \"name\": \"3.jpg\",\n        \"timer\": 3\n    }\n]\n</code></pre> <p>ProTip: You can totally avoid using www interface and write yourself other application that will allow generation of config files. All you need is DB and synchronized media folder for end devices to work properly.</p> <ul> <li>What can be done:</li> </ul> <p>Notifications when database is down/device can't connect to it. Requires making API in PHP or adding SFTP ability to put notification as file -&gt; use booth DB and file based notification system simultaneously.</p> <p>More secure login - captcha like method by default in background than shown if needed</p> <p>Mail system for new notifications //as described above</p> <p>Sending things in JS to avoid refreshing website, but since I'm \"refresh the page + PHP\" enjoyer + don't like JS (KEKW wrote Electron.js client BTW) - I wil most likely not do that.</p> <p>Some JS for frontend to avoid using \"move up\" and \"move down\" and rearrange images and videos in display.php by hand that send changes one click. For example send array into PHP.</p>"},{"location":"Raspberry%20PI%20Build/","title":"Raspberry PI parts for portable and small-factor client device","text":""},{"location":"Raspberry%20PI%20Build/#example-build","title":"Example Build","text":"<p>\"TV BOX\" can be deployed on Raspberry PI which can be configured to specific requirements and for specific localization. Below the example build with example links for my local supplier:</p> <ul> <li> <p>Raspberry Pi 5 2GB RAM: https://botland.com.pl/moduly-i-zestawy-raspberry-pi-5/25346-raspberry-pi-5-2gb-5056561803302.html</p> </li> <li> <p>Power supply (USB C 5,1V / 5A | 27W): https://botland.com.pl/zasilacze-do-raspberry-pi-5/23907-raspberry-pi-27w-usb-c-power-supply-oficjalny-zasilacz-usb-c-51v-5a-do-raspberry-pi-5-czarny-5056561803418.html</p> </li> <li> <p>At least A2 Class SD Card 32GB, pick 64GB to be sure your media folder would fit: https://botland.com.pl/karty-pamieci-raspberry-pi/25742-karta-pamieci-raspberry-microsd-64gb-100mbs-klasa-a2-z-systemem-raspberry-pi-os-z-adapterem-oraz-etui-w-zestawie-5056561804927.html</p> </li> <li> <p>Case for the safety and easier montage of the device | It's advised to use cooling FAN since device can get hot in certain locations and playing high quality video media: https://botland.com.pl/obudowy-do-raspberry-pi-5/23993-obudowa-do-raspberry-pi-5-z-wentylatorem-czarna-5906063496024.html  | Alternative cheap case (less resistant): https://botland.com.pl/obudowy-do-raspberry-pi-4b/16791-obudowa-justpi-do-raspberry-pi-4b-z-wentylatorem-czarna-5903351242615.html</p> </li> <li> <p>WI-FI Network card with long antenna and support for many WI-FI standards (optional - Pi5 have quite nice built in card): https://www.x-kom.pl/p/554803-karta-sieciowa-tp-link-archer-t3u-plus-1300mb-s-a-b-g-n-ac-dualband.html</p> </li> </ul> <p></p> <p></p> <p>For this setup remember to set screen resolution o 1920x1080 60FPS max to prevent stuttering and lags. The FAN will spin after system shutdown as long as the power is provided for the device. It also spins up when plugged in to the wall outlet. It's just plugged into 2 pins on the board that receive.</p>"},{"location":"deployment/","title":"Deploy","text":""},{"location":"deployment/#how-to-deploy-tv-box-system","title":"How to deploy TV-BOX system","text":""},{"location":"deployment/#first-you-need-to-deploy-the-admin-panel-www-interface-to-manage-devices","title":"First you need to deploy the 'admin panel' - www interface to manage devices.","text":"<ul> <li>This requires www server and MySQL/MariaDB database</li> <li>Create database named 'tv_box' (or choose any other name, app pulls DB from db_config.json) and import '.sql' file located in root www repository folder</li> <li>Now you can delete default 'admin' user or replace password hash /-&gt; if you deploy to the live server</li> <li>Copy paste files into your www server</li> <li>Edit pdo.php and enter valid credentials for your database</li> <li> <p>Log in into default admin account (login: admin | pwd: admin) or if you deleted it -&gt; INSERT new one you can generate SQL Query by going to <code>acc_gen.php</code></p> </li> <li> <p>remember to set the PHP MAX POST and UPLOAD size UP - to for example 500MB if you wanna use upload on the www interface not the FTP only &lt;- Because you can do it too.</p> </li> </ul>"},{"location":"deployment/#deploy-client-side","title":"Deploy client side","text":"<ul> <li>You can deploy the client in 2 different ways</li> <li>Directly install node.js and run app as node project</li> <li>Compile / get compiled version from repo and install the application</li> <li>Enter valid credentials into <code>db_config.json</code> and <code>remote_config.json</code> located in root directory.</li> <li>Edit and configure app in <code>app_config.json</code></li> <li>If you installed program from the executable file, you may have to run it once before setup. Program will generate all required config files if they are not present in the program directory</li> <li>If you are testing/developing and you don't have database password set you can leave 'password' field empty-&gt;<code>\"\"</code></li> </ul>"},{"location":"deployment/#windows","title":"Windows","text":"<ul> <li>If you want to run program every time system starts:<pre><code>RUN -&gt; (Windows+R)\nType -&gt; shell:startup\nInsert shortcut to the application in the opened folder\n</code></pre> </li> </ul> <p>The instal directory for the app is:                 C:\\Users\\AwsD\\AppData\\Local\\Programs\\tv-box_electron The config/working directory for the app is:                 C:\\Users\\AwsD\\AppData\\Roaming\\TV-BOX-CLIENT</p>"},{"location":"deployment/#linux-raspberry-pi","title":"Linux / Raspberry Pi","text":"<ul> <li>If you want to run program every time system starts (installed version)</li> <li>This works in Raspberry PI and /should work on most Linux systems</li> </ul> <p>Create and edit file:</p> <pre><code>    sudo nano /etc/xdg/autostart/tv-box.desktop\n</code></pre> <p>Inside the file:</p> <pre><code>    [Desktop Entry]\n    Name=tv-box_electron\n    Exec=tv-box_electron\n</code></pre> <p>SAVE file and Reboot to test it | Created file may need 'X' (Execute) permissions</p> <p>The instal directory for the app is:                 /opt/TV-BOX-CLIENT The config directory for the app is:                 ~/.config/TV-BOX_CLIENT</p> <ul> <li> <p>If you want to auto start the node version -&gt; make .sh (shell) file with proper <code>npm start</code> command and execute it on system start</p> </li> <li> <p>Should work on most Linux systems Navigate into $HOME/.config/autostart and create '.desktop' file, within the file:</p> <pre><code>[Desktop Entry]\nType=Application\nExec=\"&lt;/path/to/script&gt;\"\nHidden=false\nNoDisplay=false\nX-GNOME-Autostart-enabled=true\nName=Startup Script\n</code></pre> </li> </ul>"},{"location":"deployment/#node-install","title":"Node install","text":"<p>https://azukidigital.com/blog/2019/electron-application-on-raspberry-pi/</p> <p>Download node: https://nodejs.org/en/download/</p> <p>Unpack node go into its folder -&gt; cd node</p> <pre><code>    sudo cp -R bin/* /usr/local/bin/\n    sudo cp -R include/* /usr/local/include/\n    sudo cp -R lib/* /usr/local/lib/\n    sudo cp -R share/* /usr/local/share/\n\n    npm install --save-dev electron\n</code></pre> <p>The instal directory for the app is:                 /opt/TV-BOX-CLIENT The config/working directory for the app is:                 ~/.config/TV-BOX-CLIENT</p>"},{"location":"faq/","title":"FAQ","text":""},{"location":"faq/#faq_1","title":"FAQ","text":""},{"location":"faq/#can-you-assign-all-devices-to-one-channel","title":"Can you assign all devices to one channel?","text":"<p>Yes.</p>"},{"location":"faq/#can-you-assign-device-to-more-than-one-channel","title":"Can you assign device to more than one channel?","text":"<p>No.</p>"},{"location":"faq/#can-you-change-interval-of-device-ping-timer","title":"Can you change interval of device 'ping' timer?","text":"<p>Yes, the configuration let's you change appLoop timer and DB reconnection timer. If you increase Loop Time - remember to edit web panel too. It displays different status color depending on device last dbPing() -&gt; timestamp in database. I recommend to make status \"yellow\" after 2 pings didn't come through. If you ping database every 3 minutes - maybe set status \"RED\" after some bigger amount of time than 4, 6 pings. The app won't ping database while downloading files, so when network is slow or there are many files to download devices may show up as yellow or even red on the ww panel.</p>"},{"location":"faq/#where-can-i-deploy-the-app","title":"Where can I deploy the app?","text":"<p>In case off backend (management panel) - most basics hostings that have option to create at least one database are enough. Form the clients - since it's Electron.js app, it can be deployed ANYWHERE. Just compile it to target operating system or not - you can install node js and just npm run it!</p>"},{"location":"faq/#where-can-i-get-in-contact-with-the-developer","title":"Where can I get in contact with the developer?","text":"<p>Here: Github | LinkedIn</p>"}]}